<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Cloudera Quickstart Single Node</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">sparklyr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="dplyr.html">
    <span class="fa fa-table"></span>
     
    dplyr
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-sitemap"></span>
     
    ML
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mllib.html">
        <span class="fa fa-star-o"></span>
         
        Spark MLlib
      </a>
    </li>
    <li>
      <a href="h2o.html">
        <span class="fa fa-tint"></span>
         
        H2O
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="extensions.html">
    <span class="fa fa-plug"></span>
     
    Extensions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-upload"></span>
     
    Deployment
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="deployment.html">
        <span class="fa fa-binoculars"></span>
         
        Overview
      </a>
    </li>
    <li>
      <a href="deployment_examples.html">
        <span class="fa fa-graduation-cap"></span>
         
        Deployment Examples
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="examples.html">
    <span class="fa fa-graduation-cap"></span>
     
    Examples
  </a>
</li>
<li>
  <a href="reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/sparklyr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Cloudera Quickstart Single Node</h1>

</div>


<div id="introdution" class="section level2">
<h2>Introdution</h2>
<p>The plan is to leverage the <a href="https://www.cloudera.com/documentation/enterprise/5-6-x/topics/quickstart_docker_container.html">Cloudera Quickstart Docker container</a> to quickly create a YARN managed environment you can test sparklyr on. This instructions focus on deploying this server in on <a href="https://aws.amazon.com/ec2/">Amazon’s EC2 hosted server</a>. If you are already a Docker user, and prefer to install it on your local machine, please feel free to adapt the instructions to suit.</p>
</div>
<div id="ec2-instance" class="section level2">
<h2>EC2 Instance</h2>
<p>Here are the details of the EC2 instance we used:</p>
<ul>
<li><strong>Type:</strong> t2.large</li>
<li><strong>OS:</strong> Ubuntu 16 (Xenial)</li>
<li><strong>Disk space:</strong> At least 40GB (since you may be creating copies of the image)</li>
<li><strong>Security group:</strong> Consider opening the ports listed in the <em>Installing Cloudera</em> section</li>
</ul>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<div id="installing-docker" class="section level3">
<h3>Installing docker</h3>
<p>These following commands are taken from the <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/">Install Docker on Ubuntu</a> instructions. We’ve selected the steps that match to the Ubuntu OS selected in the <em>EC2 Instance</em> section.</p>
<pre class="bash"><code>sudo apt-get update
sudo apt-get install apt-transport-https ca-certificates
sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
echo &quot;deb https://apt.dockerproject.org/repo ubuntu-xenial main&quot; | sudo tee /etc/apt/sources.list.d/docker.list
sudo apt-get update
sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual
sudo apt-get install docker-engine
sudo service docker start</code></pre>
<p>Test docker by running the ‘hello world’ image</p>
<pre class="bash"><code>sudo docker run hello-world</code></pre>
</div>
<div id="installing-cloudera" class="section level3">
<h3>Installing Cloudera</h3>
<p>Pull the latest Cloudera Quickstart docker image. The file is around 4GBs.</p>
<pre class="bash"><code>sudo docker pull cloudera/quickstart:latest</code></pre>
<p>This is where we divert from the ‘run’ command in the original instructions. We will map the container’s ports to predictable ports in the EC2 instance, this so that they can be access via the Web. Here is a list of the port and the services the map:</p>
<ul>
<li>Hue: 8888</li>
<li>Spark History Server: 18088</li>
<li>RStudio Server: 8787</li>
<li>Cloudera Manager (not enabled by default): 7180</li>
<li>sparklyr web UI: 8088</li>
<li>Shiny: 3838</li>
</ul>
<pre class="bash"><code>sudo docker run --hostname=quickstart.cloudera --privileged=true -t -i -p 8888:8888 -p 18088:18088 -p 8787:8787 -p 7180:7180 -p 8088:8088 -p 3838:3838 cloudera/quickstart /usr/bin/docker-quickstart</code></pre>
<p>The command will initiate the cluster. After it’s completed, the terminal session your are in will be inside the docker container’s session. The prompt will now read: “[<a href="mailto:root@quickstart">root@quickstart</a> /]#”</p>
</div>
<div id="installing-rstudio" class="section level3">
<h3>Installing RStudio</h3>
<p>Now we will install the following:</p>
<ul>
<li>wget - To download files</li>
<li>Base R</li>
<li>RStudio Server</li>
<li>Package dependencies</li>
</ul>
<pre class="bash"><code>yum install wget
sudo yum install R
wget https://s3.amazonaws.com/rstudio-dailybuilds/rstudio-server-rhel-1.0.118-x86_64.rpm
sudo yum install --nogpgcheck rstudio-server-rhel-1.0.118-x86_64.rpm
yum install openssl-devel; yum install libcurl-devel; yum install libxml2-devel</code></pre>
<p>Setup default user</p>
<pre class="bash"><code>sudo adduser [made-up-user]
sudo passwd [made-up-password]</code></pre>
</div>
<div id="installing-sparklyr" class="section level3">
<h3>Installing sparklyr</h3>
<ul>
<li><p>Navigate to your RStudio Server, port 8787</p></li>
<li><p>Sign on with the default user setup in the previous section</p></li>
<li><p>Install sparklyr and tidyverse. Because today the package is being maintained on a regular basis, we will install the dev version of sparklyr. Feel free to install the CRAN version if preferred.</p></li>
</ul>
<pre class="r"><code>install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;rstudio/sparklyr&quot;)
install.packages(&quot;tidyverse&quot;)</code></pre>
<p>Here’s the code we’ll use to connect to the local Cloudera Quickstart single-node cluster. The main part of the code is to setup the Spark Home to a path inside the Quickstart installation.</p>
<pre class="r"><code>library(sparklyr)
library(dplyr)
Sys.setenv(SPARK_HOME = &#39;/usr/lib/spark&#39;)
sc &lt;- spark_connect(master = &quot;yarn-client&quot;, version=&quot;1.6.0&quot;)</code></pre>
</div>
</div>
<div id="management" class="section level2">
<h2>Management</h2>
<div id="shutting-down" class="section level3">
<h3>Shutting down</h3>
<p>If you wish to <strong>stop</strong> the EC2 instance without loosing your work, please make sure to stop all the services inside the container first.</p>
<p>The services that we stop are based on the <a href="https://www.cloudera.com/documentation/enterprise/5-5-x/topics/cdh_ig_services_stop.html">Stopping CDH Services Using the Command Line</a> article.</p>
<ul>
<li>Copy and paste this long concatenated command inside the container:</li>
</ul>
<pre class="bash"><code>sudo service hue stop; sudo service impala-server stop; sudo service impala-catalog stop; sudo service impala-state-store stop; sudo service oozie stop; sudo service hiveserver2 stop; sudo service hive-webhcat-server stop; sudo service hive-metastore stop; sudo service flume-ng-agent stop;sudo service sqoop-metastore stop; sudo service sqoop2-server stop; sudo service hbase-solr-indexer stop;sudo service spark-worker stop; sudo service spark-history-server stop; sudo service spark-master stop; sudo service sentry-store stop; sudo service solr-server stop; sudo service hbase-thrift stop; sudo service hbase-rest stop; sudo service hbase-regionserver stop; sudo service hbase-master stop; sudo service hadoop-0.20-mapreduce-jobtrackerha stop ; sudo service hadoop-0.20-mapreduce-jobtracker stop ; sudo service hadoop-0.20-mapreduce-tasktracker stop; sudo service hadoop-mapreduce-historyserver stop;  sudo service hadoop-yarn-resourcemanager stop; sudo service hadoop-yarn-nodemanager stop; sudo service hadoop-httpfs stop; sudo service hadoop-hdfs-nfs3 stop; sudo service hadoop-hdfs-secondarynamenode stop; sudo service hadoop-hdfs-namenode stop; sudo service hadoop-hdfs-journalnode stop; sudo service hadoop-hdfs-datanode stop ; sudo service hadoop-kms-server stop; sudo service zookeeper-server stop;</code></pre>
<ul>
<li>Run the <strong>exit</strong> command, this will take you back to the EC2 prompts</li>
<li>In the EC2 terminal, type <strong>sudo docker ps</strong> to confirm the container is stopped</li>
<li>Stop the EC2 instance in AWS</li>
</ul>
</div>
<div id="starting-up" class="section level3">
<h3>Starting up</h3>
<ul>
<li>Logon the server</li>
<li>We will try to get the instance id by attempting to delete the image. This has been the best way I found to obtain the id of a container that is stopped.</li>
</ul>
<pre class="bash"><code>sudo docker rmi cloudera/quickstart</code></pre>
<ul>
<li>In the warning message, note the container ID that it says depends on the image</li>
<li>Start the container</li>
</ul>
<pre class="bash"><code>sudo docker start [container id]</code></pre>
<ul>
<li>This command will attach your terminal session to the container</li>
</ul>
<pre class="bash"><code>sudo docker attach [container id]</code></pre>
<ul>
<li><p>Inside the docker container, start the rstudio-server</p>
<pre><code>[root@quickstart /]# sudo service rstudio-server start</code></pre></li>
</ul>
</div>
</div>



<footer class="footer">
  <div class="text-muted"><strong>sparklyr</strong> is an <a href="https://www.rstudio.com">RStudio</a> project. &copy; 2016 RStudio, Inc.</div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-20375833-13', 'auto');
  ga('send', 'pageview');

</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
